(function(){function n(n,t,i){this.rush=i;this.speed=3;this.x=n;this.y=t;this.width=10;this.height=10;this.isKilling=!1;this.isFinished=!1;this.dPulsate=0;this.dom=$("<zergling>").css({width:this.width,height:this.height,position:"absolute",display:"block",background:"red",left:n,top:t,borderRadius:"5px",zIndex:9999}).appendTo(r)}function s(t){for(var u=this,f=this.zerglings=[],e=this.targets=[],r=0;r<t;++r)f.push(new n(i()*100,i()*100,this));this.intervalID=setInterval(function(){u.step()},30)}window.Zergling=n;window.ZergRush=s;var t=document,r=t.body,h=Math.atan2,u=Math.cos,f=Math.sin,e=Math.PI,i=Math.random,o=Math.max;n.DATA_KEY="zergTargetData";n.MAX_TARGET_AREA=5e4;n.VISION=1e3;n.LIFE=100;n.isSuitableTarget=function(t){var r,i;if(!t)return!1;for(i=t;i=i.parentNode;)if($.data(i,n.DATA_KEY)||/antiZerg/i.test(i.className))return!1;return r=$.data(t,n.DATA_KEY),t=$(t),!/zergling/i.test(t[0].nodeName)&&!/antiZerg/i.test(t[0].className)&&(!r||r.life>0)&&t.width()*t.height()<n.MAX_TARGET_AREA};n.prototype={calcMovement:function(){var n=this.target,r=n.position.left+i()*n.width-this.x,e=n.position.top+i()*n.height-this.y,t=h(e,r);this.dx=this.speed*u(t);this.dy=this.speed*f(t)},draw:function(){if(!this.isFinished){var t=this.target;if(this.isKilling){t.life>0?(t.life--,this.pulsate(),t.dom.css("opacity",t.life/n.LIFE)):(t.dom.css("visibility","hidden"),this.pulsate(0),this.isKilling=!1,this.target=null);return}if(!this.target||this.target.life<=0)if(this.findTarget())t=this.target,this.calcMovement();else{this.isFinished=!0;this.dom.fadeOut(100,function(){$(this).remove()});return}if(this.hasReachedTarget()){this.isKilling=!0;return}this.x+=this.dx;this.y+=this.dy;this.dom.css({left:this.x,top:this.y})}},hasReachedTarget:function(){var t=this.target,n=t.position;return this.x>=n.left&&this.y>=n.top&&this.x<=n.left+t.width&&this.y<=n.top+t.height},findTarget:function(){for(var c,h,l,a,i,v=this.width/2,y=this.height/2,p=o(r.scrollTop,t.documentElement.scrollTop),w=o(r.scrollLeft,t.documentElement.scrollLeft),s=10;s<n.VISION;s+=50)for(h=0;h<360;h+=45)if(l=this.x+v+s*u(e/180*h)-w,a=this.y+y+s*f(e/180*h)-p,n.isSuitableTarget(i=t.elementFromPoint(l,a)))return i=$(i),c=this.target=i.data(n.DATA_KEY),c||(i.data(n.DATA_KEY,this.target={dom:i,position:i.offset(),width:i.width(),height:i.height(),life:n.LIFE,initialCSS:{visibility:"",opacity:i.css("opacity")||""}}),this.rush.registerTarget(this.target)),!0},pulsate:function(){(this.dPulsate=!this.dPulsate)?this.dom.css({left:this.x-2,top:this.y-2,width:14,height:14}):this.dom.css({left:this.x,top:this.y,width:10,height:10})}};s.prototype={step:function(){for(var t=!0,n=0;n<this.zerglings.length;++n)this.zerglings[n].draw(),t=t&&this.zerglings[n].isFinished;t&&clearInterval(this.intervalID)},destroy:function(){var i,t;for(clearInterval(this.intervalID),i=0;i<this.zerglings.length;++i)this.zerglings[i].dom.remove();for(t=0;t<this.targets.length;++t)this.targets[t].dom.css(this.targets[t].initialCSS),this.targets[t].dom.removeData(n.DATA_KEY)},registerTarget:function(n){this.targets.push(n)}}})();